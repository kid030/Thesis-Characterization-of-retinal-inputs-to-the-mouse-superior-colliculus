<div>To label the dendritic trees of the imaged cells in the confocal Z-stacks, we either applied a thresholding approach to identify pixels belonging to the cells, or we sent the data set to Ariadne-service GmbH (Switzerland; ariadne.ai) for tracing of the dendritic tree. The position of the ChAT-planes was extracted and used to warp both the ChAT-signal as well as the binary Z-stack of the labeled cell. Then, dendrites from other cells, noise, and axons were removed and the position of the cell body was measured. The resulting warped dendritic tree was used for further analysis such as computation of the dendritic profile, area measurements and dendritic statistics. All code can be found on github&nbsp;(<a href="https://github.com/farrowlab/Reinhard_2019">https://github.com/farrowlab/Reinhard_2019</a>; copy archived at&nbsp;<a href="https://github.com/elifesciences-publications/Reinhard_2019">https://github.com/elifesciences-publications/Reinhard_2019</a>;&nbsp;<a href="https://github.com/farrowlab/ChATbandsDetection">https://github.com/farrowlab/ChATbandsDetection</a>; copy archived at&nbsp;<a href="https://github.com/elifesciences-publications/chATbandsDetection">https://github.com/elifesciences-publications/chATbandsDetection</a>).</div><div><b>Down-sampling and binarization/tracing</b></div><div>The confocal Z-stacks of individual ganglion cells were denoised using the CANDLE package for MATLAB (<a href="https://elifesciences.org/articles/50697#bib13">Coupé et al., 2012</a>) and down-sampled to have a resolution of XYZ&nbsp;=&nbsp;0.5×0.5 x (0.25 to 0.35) µm per pixel and saved as MATLAB files. We then manually selected a threshold to transform the GFP-signal (i.e. the labeled cell) into a binary version where the whole dendritic tree was visible but noise was reduced as much as possible using an adapted version of the method described in&nbsp;<a href="https://elifesciences.org/articles/50697#bib88">Sümbül et al. (2014a)</a>&nbsp;and&nbsp;<a href="https://elifesciences.org/articles/50697#bib89">Sümbül et al. (2014b)</a>. Alternatively, the confocal Z-stacks were sent to Ariadne-service GmbH where the dendritic tree of each neuron was traced.</div><div><b>Extraction of ChAT-positions</b></div><div>ChAT-band positions were either extracted manually or automatically using a convolutional neural network. For manual extraction, the ChAT-signal was smoothed using a two-dimensional standard-deviation filtering approach in the XY plane with a size of 21 × 21 pixels. The resulting Z-stacks were loaded into Fiji (<a href="https://elifesciences.org/articles/50697#bib80">Schindelin et al., 2012</a>). ChAT-band positions were marked as described in&nbsp;<a href="https://elifesciences.org/articles/50697#bib88">Sümbül et al. (2014a)</a>. Briefly, we labeled points in the ON- and OFF-band with an approximate spacing of 20 µm in X- and Y-direction. For automated labeling, an end-to-end 3D Convolutional Neural Network called V-Net with a Dice Loss Layer (<a href="https://elifesciences.org/articles/50697#bib66">Milletari et al., 2016</a>) was trained on noisy greyscale images of ChAT-images, to denoise and remove any cell bodies, creating a probability map of background and foreground, with foreground being voxels that might belong to the ChAT-bands. Two smoothness-regularized-least squares surfaces were fitted to manually labeled data to train the algorithm and to create ground truth binary masks. Then, Otsu's thresholding method combined with connected component analysis was performed on the resulting probability map to automatically locate the points that belong to the ChAT-bands in new data-sets. Finally, two surfaces were independently fit to the corresponding data points to approximate the two ChAT-bands (<a href="https://github.com/farrowlab/ChATbandsDetection">https://github.com/farrowlab/ChATbandsDetection;&nbsp;</a>copy&nbsp;archived&nbsp;at&nbsp;<a href="https://github.com/elifesciences-publications/chATbandsDetection">https://github.com/elifesciences-publications/chATbandsDetection</a>).</div><div>Warping</div><div>An adapted version of the code developed in the lab of Sebastian Seung was used to warp the GFP-signal (<a href="https://elifesciences.org/articles/50697#bib88">Sümbül et al., 2014a</a>). Briefly, the ChAT-band locations were used to create a surface map, which then was straightened in 3D-space. Then, the binarized GFP-signal was warped accordingly.</div><div>Soma position and removal of noise</div><div>After warping, the soma position was determined by filtering the GFP-signal with a circular kernel (adapted from&nbsp;<a href="https://elifesciences.org/articles/50697#bib88">Sümbül et al., 2014a</a>). If this method detected the soma, it was used to remove the soma from the GFP-data and the center of mass was taken as the soma position. If this automated method failed, the soma position was marked manually. Afterwards, dendrites of other cells, axons, and noise were removed manually: The warped GFP-signal was plotted in side-view and en-face view in MATLAB and pixels belonging to the cell were selected manually.</div><div>Computation of the dendritic profile and area</div><div>The distribution of the cell’s dendritic tree was computed (<a href="https://elifesciences.org/articles/50697#bib88">Sümbül et al., 2014a</a>). Briefly, the Z-positions of all GFP-positive pixels were normalized to be between −0.5 and 0.5. Then the Fourier transform of an interpolating low-pass filter was used to filter the Z-positions. This resulted in a vector containing the distribution of pixels in the Z-direction. If necessary, this profile was used to manually remove remaining axonal or somal pixels. In this case, the dendritic profile was computed again after cleaning of the data. The area of the dendritic tree was approximated by computing a convex hull (regionprops function in MATLAB). When diameters are given, they were calculated as D&nbsp;=&nbsp;2*(area / π)<sup>1/2</sup>.</div><div>Computation of the dendritic statistics</div><div>To compute the dendritic statistics a minimal spanning tree model was created of each imaged dendritic tree using the TREES toolbox with a branching factor of 0.4. From this tree we calculated a set of five statistics including: the mean ratio of path length and Euclidean distance; maximum metric path length; mean branch lengths; mean path length and z-range against width of spanning field (<a href="https://elifesciences.org/articles/50697#bib15">Cuntz et al., 2011</a>).</div><div>Down-sampling of dendritic tree for plotting</div><div>For en-face plots of the dendritic arbor, they were down-sampled by calculating the local neighborhood median of all labeled pixels in patches of 50 × 50 pixels and with a sliding window of 10 pixels.</div><div><b>Ganglion cell type assignment</b></div><div><b>Preparation of dendritic profile templates</b></div><div>Templates of each cell type were created from the 381 traced retinal ganglion cells from EM sections of the museum.eyewire.org data basw. The EM data set was complemented by three additional data sets: Dendritic trees of examples of HD1, HD2 (<a href="https://elifesciences.org/articles/50697#bib46">Jacoby and Schwartz, 2017</a>) and ventral OFF OS cells (<a href="https://elifesciences.org/articles/50697#bib70">Nath and Schwartz, 2017</a>) were obtained from Greg Schwartz (Feinberg School of Medicine, Northwestern); examples of M2 (Cdh3) and sustained OFF-alpha cells (W7b) were obtained from Uygar Sümbül (<a href="https://elifesciences.org/articles/50697#bib88">Sümbül et al., 2014a</a>), and dendritic profiles four FOXP2-positive cell types were extracted from&nbsp;<a href="https://elifesciences.org/articles/50697#bib78">Rousso et al. (2016)</a>. Except for the FOXP2-positive cells, all data were processed in the same way as our data (warping, removal of axons) and average dendritic profiles were calculated for each cell type resulting in 56 profile templates.</div><div><b>Correlation measurements</b></div><div>For each of our traced retinal ganglion cell, we calculated the linear correlation coefficient (corrcoef function in Matlab) and Euclidean distance (pdist function in Matlab) of its dendritic profile to each of the 56 templates. If the molecular identity of the cell was known, the set of compared templates was reduced to matching candidates, for&nbsp;example to the alpha cells of the EM data set (cluster 1wt, 4ow, 6sw, 8w) and the W7b profile of the Sümbül data set for an SMI32<sup>+</sup>&nbsp;cell. All clusters with a correlation coefficient or an Euclidean distance above a set threshold were considered as potential types for this cell. Thresholds were defined as the squared lower quartile of coefficients/distances of all molecularly identified cell types. For molecularly identified cells without any correlation or distance above threshold, the best match was kept. Other cells without any correlation coefficient or distance measurement above the threshold were assigned as non-classifiable.</div><div><b>Decision tree</b></div><div>The correlation and distance measurements strongly reduced the number of potential matching templates. Cells were then assigned to one of the remaining templates based on a decision tree considering aspects of the dendritic profile, dendritic and soma size, and principal component analysis of the complete dendritic tree (pca function in Matlab). All cluster numbers (C-) used in the following text refer to the EM clusters in&nbsp;<a href="https://elifesciences.org/articles/50697#bib5">Bae et al. (2018)</a>. Below is a detailed description of how cells lying within the same stratification were assigned.</div><div><i>Cells stratifying below the ON-ChAT band:</i>&nbsp;a) C-85 separates from others as it has an additional peak in its dendritic profile that lies between the ChAT-bands. b) C-9w separate by their very large dendritic tree. c) C-8n, C-8w, C-9n differ from the remaining candidates as they lack dendrites above the OFF-ChAT-band. Within these three clusters, the alpha cells forming C-8w are distinguished by their very large soma. C-8n and C-9n could not be further distinguished. d) Of the remaining potential candidates, C-82wi and C-82wo are significantly larger than the other types. e) C-72 and C-73 were distinguished from each other based on the principal component analysis of their complete dendritic tree.</div><div><i>Cells stratifying between the ChAT bands:</i>&nbsp;a) Within clusters with dendrites close to the ON-ChAT-band, only C-6t (Fmidi-ON cells) extend their dendrites below the ChAT-band (see also&nbsp;<a href="https://elifesciences.org/articles/50697#bib78">Rousso et al., 2016</a>); to distinguish C-6sn and C-6sw (ON transient alpha cells), C-6sw have considerably bigger dendritic trees. b) Cells in C-5to and C-63 have particularly broad dendritic profiles, which are distinguished from each other as the dendrites of C-63 extend below the ON-ChAT-band and above the OFF-ChAT-band, whereas the dendrites of C-5to do not. c) Of the clusters with dendrites around the center of the ChAT-bands, C-5si is biased towards the ON-ChAT-band. Cells that fit best to either of the two HD cell types obtained from the Schwartz lab were assigned to cluster C-5si. d) The few cells with dendrites extending above the OFF-ChAT-band, potential C-5ti or C-51, could not be clearly distinguished from each other. e) Of cells with dendrites closer to the OFF-ChAT-band, the trees of C-4ow (OFF transient alpha cells) are substantially bigger than of the other cell types, C-4i and C-4on, which could not be distinguished from each other.</div><div><i>Cells stratifying above the OFF-ChAT band:</i>&nbsp;a) Cells in C-25 separate from other cells in this group based on an additional profile peak between the ChAT-bands. b) C-27 and C-28 contain the only cells with dendrites extending below the ON-ChAT-band. They were distinguished from each other based the principal component analysis of their complete dendritic tree. c) Of the clusters with dendrites extending below the OFF-ChAT-band, C-1wt (OFF sustained alpha cells) are considerably larger than the other cells and C-2an contains substantially smaller cells than C-3i and C-3o. d) Of the cells with dendrites far above the OFF-ChAT-band, C-1ws (M1 cells) are the largest cell type in the retina. C-1ni and C-1no were not distinguishable.</div><div>Cells that did not fulfil the criterions of any cluster within their group were considered ‘non-classifiable’. We did not distinguish between different types of ON-OFF-DS (37 c,d,r,v) and ON-DS cells (7id,ir,iv,o).</div><div><b>Visual inspection</b></div><div>After assigning each cell to an EM-cluster, the en-face and side-views of all cells in a given cluster were visually inspected. For potential outliers, we compared the dendritic statistics of this cells to the statistics of its current and two next best candidate cell types. If the statistics were closer to the average statistics of an alternative cluster, this cell was reassigned. In addition, some cells of C-8n and C-8w could not be clearly assigned based on their soma. However, the sustained alpha cells in C-8n have a particular soma shape and pattern of dendritic roots. In these cases, the detailed dendritic and soma morphology in the original confocal scans were inspected and reassigned by an expert.</div><div><b>Size distribution analysis</b></div><div>For retinotopic size distribution calculations, we computed a moving median diameter within a circular window of 250 µm radius, using a step size of 100 µm. The resulting 50 × 50 median size matrix was convolved with a gaussian with sigma&nbsp;=&nbsp;200 µm (using MATLAB function fspecial and nanconv).</div><div>Quantification of SMI32<sup>+</sup>&nbsp;cells, CART<sup>+</sup>&nbsp;cells and FOXP2<sup>+</sup>&nbsp;cells</div><div><a href="https://bio-protocol.org/eLIFErap50697?item=s4-5-10">Request a detailed protocol</a></div><div>Numbers of double-labeled cells</div><div><a href="https://bio-protocol.org/eLIFErap50697?item=s4-5-10-1">Request a detailed protocol</a></div><div>To quantify the number of double-positive cells for CART/GCaMP6s and SMI32/GCaMP6s, we scanned a z-stack (1 to 5 µm Z-resolution) of the whole retina using the confocal microscope with an 10x objective. Images of the anti-CART, SMI32 or FOX2 and the anti-GFP staining were opened in Fiji. For counting CART<sup>+</sup>&nbsp;cells, cells were marked using the point tool and counted manually. Note that the anti-CART antibody also labels a group of amacrine cells, therefore the complete Z-stack should be checked for each CART<sup>+</sup>&nbsp;cell to make sure that the labelling truly overlaps with the anti-GFP signal. The CART expression pattern was consistent with previous reports (<a href="https://elifesciences.org/articles/50697#bib50">Kay et al., 2011</a>). In total we counted three retinas for parabigeminal experiments and six retinas for pulvinar experiments. For SMI32 stainings, cells were counted manually using the cell counter plugin. In total, we counted three retinas for parabigeminal experiments and four retinas for pulvinar experiments. For FOXP2 stainings, cells were counted manually using the cell counter plugin. In total, we counted five retinas for parabigeminal experiments and eight retinas for pulvinar experiments.</div><div>Numbers of cells for types of alpha cells</div><div><a href="https://bio-protocol.org/eLIFErap50697?item=s4-5-10-2">Request a detailed protocol</a></div><div>To test which of the four alpha cell types were part of each circuit, we acquired small high-resolution Z-stacks (2.5 µm/pixel) of XY&nbsp;=&nbsp;103×103 µm size (128 × 128 pixel, 63x objective) covering the full depth of the dendritic tree and centered around the soma of 91 SMI32<sup>+</sup>&nbsp;/ GCaMP6s<sup>+</sup>&nbsp;cells in n&nbsp;=&nbsp;3 retinas from parabigeminal experiments and 90 SMI32<sup>+</sup>&nbsp;/ GCaMP6s<sup>+</sup>&nbsp;cells in n&nbsp;=&nbsp;3 retinas from pulvinar experiments. We plotted top and side views of each Z-stack in MATLAB and manually decided for each cell if it was a sustained ON-alpha cell (dendrites below the ON- ChAT band), a transient ON-alpha (dendrites just above the ON- ChAT band), a transient OFF-alpha (dendrites just below or on the OFF- ChAT band) or a sustained OFF-alpha cell (dendrites above the OFF- ChAT band).</div><div>Spike sorting</div><div><a href="https://bio-protocol.org/eLIFErap50697?item=s4-5-11">Request a detailed protocol</a></div><div>The high-pass filtered in-vivo data was automatically sorted into individual units using SpyKING CIRCUS (<a href="https://elifesciences.org/articles/50697#bib99">Yger et al., 2018</a>). The following parameters were used: cc_merge&nbsp;=&nbsp;0.95 (merging if cross-correlation similarity&nbsp;&gt;&nbsp;0.95), spike_thresh&nbsp;=&nbsp;6.5 (threshold for spike detection), cut_off&nbsp;=&nbsp;500 (cut-off frequency for the butterworth filter in Hz). Automated clustering was followed by manual inspection, merging of units if necessary and discarding of noise and multi-units using phy (<a href="https://phy-contrib.readthedocs.io/">https://phy-contrib.readthedocs.io</a>). Units were evaluated based on the average waveform shape and auto-correlogram. Only cells with&nbsp;&lt;1% of inter-spike intervals of&nbsp;≤1 ms were considered. In addition, we tested if their cross correlograms with nearby neurons showed evidence for being spikes from the same neurons (<a href="https://elifesciences.org/articles/50697#bib81">Segev et al., 2004</a>;&nbsp;<a href="https://elifesciences.org/articles/50697#bib99">Yger et al., 2018</a>).</div><div>Analysis of in&nbsp;vivo recordings</div><div><a href="https://bio-protocol.org/eLIFErap50697?item=s4-5-12">Request a detailed protocol</a></div><div>Unless otherwise noted, firing rates were calculated as the number of spikes in 50 ms bins averaged across the 10 stimulus repetitions. Z-scores were calculated as the number of standard deviations from the mean spontaneous activity before stimulus onset. All sorted units were grouped into cells with a maximal response amplitude&nbsp;&gt;&nbsp;2 standard deviations above the mean spontaneous firing rate (‘potentially responding’) and cells without such a peak (‘non-responding’). The activity to each stimulus repetitions was inspected for the ‘potentially responding’ cells to identify truly responding cells manually, which then were used for further analysis, average response calculations and visualization. For small stimuli shown at three different locations and moving in two different directions, only the strongest response was considered for population analysis.</div><div>DSI</div><div><a href="https://bio-protocol.org/eLIFErap50697?item=s4-5-12-1">Request a detailed protocol</a></div><div>Direction-selectivity was calculated based on the summed, back-ground subtracted activity during the time from the onset of the fast moving square until the end of the presentation for each direction α. These eight response measurements R<sub>k</sub>&nbsp;were normalized to the maximum and the DSI was calculated according to:&nbsp;∑kRk∙eaik/∑kRk∑kRk∙eaik/∑kRk.</div><div>Half-width of response to small, slow dot</div><div><a href="https://bio-protocol.org/eLIFErap50697?item=s4-5-12-2">Request a detailed protocol</a></div><div>Mean firing rates for each cell were background subtracted and the MATLAB function findpeaks was used to find the half-width of the highest peak.</div><div>Analysis of patch-clamp recordings</div><div><a href="https://bio-protocol.org/eLIFErap50697?item=s4-5-13">Request a detailed protocol</a></div><div>The loose-patch extracellular recording traces were high-pass filtered. Events that exceeded an amplitude threshold were extracted. Unless otherwise noted, firing rates were calculated as the number of spikes in 50 ms bins averaged across the 5–10 stimulus repetitions.</div><div>Chirp</div><div><a href="https://bio-protocol.org/eLIFErap50697?item=s4-5-13-1">Request a detailed protocol</a></div><div>Average responses were calculated based on the mean number of spikes during the stimulus across 10 trials.</div><div>Frequency responses</div><div><a href="https://bio-protocol.org/eLIFErap50697?item=s4-5-13-2">Request a detailed protocol</a></div><div>Spikes produced in response to the frequency part of the chirp stimulus were binned in 1 ms bins and the Fourier Transform was calculated using the Matlab function fft. The mean Fourier Transform amplitude for different frequency ranges was calculated for&nbsp;<a href="https://elifesciences.org/articles/50697#fig6">Figure 6A</a>.</div><div>Spot-size tuning curve</div><div><a href="https://bio-protocol.org/eLIFErap50697?item=s4-5-13-3">Request a detailed protocol</a></div><div>Firing rates were background subtracted and peak responses during the first 0.4 s after each stimulus onset were calculated and used to plot a spot-size tuning curve.</div><div>DSI/OSI</div><div><a href="https://bio-protocol.org/eLIFErap50697?item=s4-5-13-4">Request a detailed protocol</a></div><div>Direction-selectivity was calculated as for the in-vivo recordings. Firing rates were background subtracted and peak responses during the first 1 s after each stimulus onset were calculated. The direction-selectivity of a ganglion cell was defined as the vector sum of these peak responses for each of the eight different directions α. These eight response measurements R<sub>k</sub>&nbsp;were normalized to the maximum and the DSI was calculated according to:&nbsp;∑kRk∙eaik/∑kRk∑kRk∙eaik/∑kRk. Similarly, the orientation-selectivity index (OSI) was calculated according to:&nbsp;∑kRk∙ea2ik/∑kRk∑kRk∙ea2ik/∑kRk.</div><div>Assigning recorded retinal ganglion cells</div><div><a href="https://bio-protocol.org/eLIFErap50697?item=s4-5-14">Request a detailed protocol</a></div><div>To assign patched ganglion cells (n&nbsp;=&nbsp;123) to the anatomical clusters, we assigned their ‘chirp’ responses to templates of identified ‘chirp’ responses. The set of templates included all 49 clusters of&nbsp;<a href="https://elifesciences.org/articles/50697#bib4">Baden et al. (2016)</a>&nbsp;and the average response of patched cells that were assigned to one of our 14 clusters based on their morphology. We had such cells with both anatomy and physiology for clusters 1, 3, 4, 5, 6, 7, 8, 11, 12, 13, 14 (n&nbsp;=&nbsp;48 cells in total). For comparison with the calcium imaging traces of the published data set, we convolved the chirp responses of the remaining 75 patched cells with the Kernel of the calcium indicator ogb1 used in&nbsp;<a href="https://elifesciences.org/articles/50697#bib4">Baden et al. (2016)</a>. Three distance measurements were calculated for each of these patched cells to compare them to the 49 + 12 templates. The distance measurements consisted of linear correlation coefficient (corrcoef function in Matlab), Euclidean distance (pdist function in Matlab) and residuals (subtraction of the response from each template). If a cluster was in the top two for at least two distance measurements, the cell was assigned to this cluster. If the distance measurements did not agree with each other, the best cluster with the highest linear correlation coefficient was taken. For each of our anatomical clusters, we plotted and further analyzed the visual response if it contained at least four patched cells. This led to the analysis of a total of 93 patched cells.</div><div>Comparison of in&nbsp;vitro and in&nbsp;vivo data</div><div><a href="https://bio-protocol.org/eLIFErap50697?item=s4-5-15">Request a detailed protocol</a></div><div>To compare the response properties of different retinal ganglion cell types and neurons in the Pbg and pulvinar, we calculated z-scores for each responding neuron as described above. Median firing rates were plotted for the different brain nuclei and retinal ganglion cell types.</div><div>Cell body size measurements</div><div>To separate sustained ON-alpha cells from non-alpha cells, we loaded the original z-stack into Fiji, calculated a maximal projection and used the ellipse tool to fit an ellipse to the cell body and measure its area.</div><div>Statistics</div><div>To compare dendritic tree diameter distributions, we applied the Kolmogorov-Smirnov test (kstest2 function in MATLAB). Medians were compared by the Wilcoxon rank sum test (ranksum function in MATLAB). We used Pearson correlation (corr function in MATLAB) to test for significant gradients in the retinotopic distribution of dendritic tree diameters.</div><div>Two tests were used to assess the statistical significance of different sampling of each cell type or response feature by the two circuits. Either, a two-proportion z-test was used, where for each cell type we computed the test parameters, k = ‘number of cells assigned to a cell type for each pathway,’ and p = ‘proportion of cell type in total population.”. We then performed a two-tailed z-test to determine if the proportion of cells of a particular cell type deviates from our null hypothesis that the proportion in the total population should be the same as in each pathway. After p value correction for false discovery rate (<a href="https://elifesciences.org/articles/50697#bib7">Benjamini and Yekutieli, 2001</a>), p values were considered significant at alpha&nbsp;=&nbsp;0.05. Or, we performed a bootstrap analysis of whether the percent difference (%LP - %Pbg / %LP + %Pbg) of sampling of each ganglion cell by the two circuits is different from zero. To accomplish this, distributions were estimated using 10,000 repetition of random sampling from all our retinas with replacement. After p value correction for multiple comparisons (<a href="https://elifesciences.org/articles/50697#bib7">Benjamini and Yekutieli, 2001</a>), p values were considered significant at alpha&nbsp;=&nbsp;0.05.</div>